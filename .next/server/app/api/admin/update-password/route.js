(()=>{var e={};e.id=750,e.ids=[750],e.modules={62849:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=62849,e.exports=t},67096:e=>{"use strict";e.exports=require("bcrypt")},72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},98216:e=>{"use strict";e.exports=require("net")},35816:e=>{"use strict";e.exports=require("process")},76162:e=>{"use strict";e.exports=require("stream")},74026:e=>{"use strict";e.exports=require("string_decoder")},95346:e=>{"use strict";e.exports=require("timers")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},72254:e=>{"use strict";e.exports=require("node:buffer")},6005:e=>{"use strict";e.exports=require("node:crypto")},15673:e=>{"use strict";e.exports=require("node:events")},47261:e=>{"use strict";e.exports=require("node:util")},39355:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>y,requestAsyncStorage:()=>m,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>f});var s={};r.r(s),r.d(s,{POST:()=>d});var a=r(73278),n=r(45002),i=r(54877),o=r(71309),u=r(93159),c=r(1035),l=r(16910);async function d(e){try{let t=await (0,l.I8)();if(!t||!t.user)return o.NextResponse.json({success:!1,message:"Tidak terautentikasi"},{status:401});let{currentPassword:r,newPassword:s}=await e.json();if(!r||!s)return o.NextResponse.json({success:!1,message:"Data tidak lengkap"},{status:400});let a=await (0,c.kY)(t.user.name);if(!a)return o.NextResponse.json({success:!1,message:"Admin tidak ditemukan"},{status:404});if(!(a.password.length<20?a.password===r:await (0,u.G)(r,a.password)))return o.NextResponse.json({success:!1,message:"Password lama tidak sesuai"},{status:400});let n=await (0,u.c)(s);return await (0,c._z)(a.id_user,n),o.NextResponse.json({success:!0,message:"Password berhasil diperbarui"})}catch(e){return console.error("Error updating password:",e),o.NextResponse.json({success:!1,message:"Kesalahan server"},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/admin/update-password/route",pathname:"/api/admin/update-password",filename:"route",bundlePath:"app/api/admin/update-password/route"},resolvedPagePath:"D:\\Aplikasi\\simbarku\\app\\api\\admin\\update-password\\route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:m,staticGenerationAsyncStorage:f,serverHooks:g}=p,h="/api/admin/update-password/route";function y(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:f})}},16910:(e,t,r)=>{"use strict";r.d(t,{I8:()=>i,qi:()=>n,zB:()=>o});var s=r(74415),a=r(35957);let{handlers:n,auth:i,signIn:o,signOut:u}=(0,s.ZP)({providers:[(0,a.Z)({name:"Credentials",credentials:{username:{label:"Username",type:"text"},password:{label:"Password",type:"password"}},async authorize(e){if(!e?.username||!e?.password)return null;try{let t=await fetch(`${process.env.NEXTAUTH_URL}/api/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({username:e.username,password:e.password})}),r=await t.json();if(r.success&&r.user)return{id:r.user.id,name:r.user.name,email:r.user.email,image:"/placeholder-user.jpg"};return null}catch(e){return console.error("Auth error:",e),null}}})],secret:process.env.AUTH_SECRET,pages:{signIn:"/login",signOut:"/",error:"/login"},session:{strategy:"jwt",maxAge:2592e3},callbacks:{session:async({session:e,token:t})=>(t.sub&&(e.user.id=t.sub),e),jwt:async({token:e,user:t})=>(t&&(e.id=t.id),e)}})},1035:(e,t,r)=>{"use strict";r.d(t,{AW:()=>E,B3:()=>A,FO:()=>L,IH:()=>R,Pz:()=>O,Rf:()=>T,Xp:()=>P,ZU:()=>U,_z:()=>S,kY:()=>k,qZ:()=>j});var s=r(87615),a=r(91141),n=r(56042),i=r(53283),o=r(57713),u=r(87420),c=r(31318),l=r(90273),d=r(41054),p=r(52792),m=r(18653),f=r(29785),g=r(9850),h=r(95013),y=r(98446),w=r(5183);let _=s.createPool({host:process.env.MYSQL_HOST||"localhost",port:Number(process.env.MYSQL_PORT)||3306,user:process.env.MYSQL_USER||"root",password:process.env.MYSQL_PASSWORD||"",database:process.env.MYSQL_DATABASE||"simbarku"}),x=(0,a.tS)(_),b=(0,n.iq)("products",{id:(0,i.e$)("id").primaryKey().autoincrement(),imageUrl:(0,o.fL)("image_url").notNull(),name:(0,o.fL)("name").notNull(),status:(0,u.MI)("status",["active","inactive","archived"]).notNull(),price:(0,c.gH)("price",{precision:10,scale:2}).notNull(),stock:(0,i.e$)("stock").notNull(),availableAt:(0,l.AB)("available_at").notNull()}),q=(0,n.iq)("admin",{id_user:(0,i.e$)("id_user").primaryKey().autoincrement(),username:(0,d.L7)("username",{length:20}).notNull(),password:(0,d.L7)("password",{length:15}).notNull()});(0,n.iq)("forum",{idPesan:(0,i.e$)("id_pesan").primaryKey().autoincrement(),isiPesan:(0,o.fL)("isi_pesan").notNull(),gambarSimbarUser:(0,p.Ec)("gambar_simbar_user"),kategori:(0,d.L7)("kategori",{length:255}).notNull()}),(0,n.iq)("testimoni",{idTestimoni:(0,i.e$)("id_testimoni").primaryKey().autoincrement(),nama:(0,o.fL)("nama").notNull(),deskripsi:(0,o.fL)("deskripsi").notNull(),rating:(0,i.e$)("rating").notNull()});let N=(0,n.iq)("transaksi",{id_transaksi:(0,i.e$)("id_transaksi").primaryKey().autoincrement(),id_user:(0,i.e$)("id_user").notNull().references(()=>v.idUser),harga:(0,i.e$)("harga").notNull(),tanggal:(0,m.hT)("tanggal").notNull(),status:(0,u.MI)("status",["completed","pending","canceled"]).notNull().default("pending")}),v=(0,n.iq)("user",{idUser:(0,i.e$)("id_user").primaryKey().autoincrement(),nama:(0,d.L7)("nama",{length:30}).notNull(),no_telp:(0,i.e$)("no_telp").notNull(),alamat:(0,o.fL)("alamat").notNull(),email:(0,o.fL)("email").notNull()});async function P(e,t=0){try{if(e){let r=await x.select().from(b).where((0,f.vL)(b.name,`%${e}%`)).limit(1e3);return{products:r,newOffset:t,totalProducts:r.length}}let r=await x.select({count:(0,g.QX)()}).from(b),s=Number(r[0].count),a=await x.select().from(b).limit(5).offset(t);return a.length,{products:a,newOffset:t,totalProducts:s}}catch(e){return console.error("Error fetching products:",e),{products:[],newOffset:0,totalProducts:0}}}async function k(e){try{let t=await x.select().from(q).where((0,f.eq)(q.username,e)).limit(1);return t.length>0?t[0]:null}catch(e){return console.error("Error fetching admin:",e),null}}async function T(e=0){try{let t=await x.select({count:(0,g.QX)()}).from(v);return{users:await x.select().from(v).limit(10).offset(e),totalUsers:Number(t[0].count)}}catch(e){return console.error("Error fetching users:",e),{users:[],totalUsers:0}}}async function O(e=0){try{let t=await x.select({count:(0,g.QX)()}).from(N);return{transactions:(await x.select({id_transaksi:N.id_transaksi,id_user:N.id_user,harga:N.harga,tanggal:N.tanggal,status:N.status,userName:v.nama}).from(N).leftJoin(v,(0,f.eq)(N.id_user,v.idUser)).limit(10).offset(e).orderBy((0,h.C)(N.tanggal))).map(e=>({...e,userName:e.userName||"Pengguna Tidak Dikenal"})),totalTransactions:Number(t[0].count)}}catch(e){return console.error("Error fetching transactions with user data:",e),{transactions:[],totalTransactions:0}}}async function j(){try{return await x.select().from(b).limit(1),console.log("Database connection successful"),{success:!0}}catch(e){return console.error("Database initialization error:",e),{success:!1,error:e}}}async function S(e,t){try{return await x.update(q).set({password:t}).where((0,f.eq)(q.id_user,e)),!0}catch(e){throw console.error("Error updating admin password:",e),e}}async function U(){try{let e=await x.select({month:(0,y.i6)`DATE_FORMAT(tanggal, '%Y-%m')`,total:(0,y.i6)`COUNT(id_transaksi)`,revenue:(0,y.i6)`SUM(harga)`}).from(N).groupBy((0,y.i6)`DATE_FORMAT(tanggal, '%Y-%m')`).orderBy((0,y.i6)`DATE_FORMAT(tanggal, '%Y-%m')`).limit(12),t=await x.select({status:N.status,count:(0,g.QX)(),revenue:(0,y.i6)`SUM(harga)`}).from(N).groupBy(N.status),r=await x.select({id_user:N.id_user,totalPurchases:(0,g.QX)(),totalSpent:(0,y.i6)`SUM(harga)`}).from(N).where((0,f.eq)(N.status,"completed")).groupBy(N.id_user).orderBy((0,h.C)((0,y.i6)`SUM(harga)`)).limit(5);return{monthlyTransactions:e,transactionsByStatus:t,topCustomers:r}}catch(e){return console.error("Error fetching transaction analytics:",e),{monthlyTransactions:[],transactionsByStatus:[],topCustomers:[]}}}async function A(e){try{if(0===e.length)return[];return await x.select().from(v).where((0,f.d3)(v.idUser,e))}catch(e){return console.error("Error fetching users by IDs:",e),[]}}async function E(e=0,t=10){try{let r=await x.select().from(v).limit(t).offset(e),s=await x.select({count:(0,g.QX)()}).from(v);return{users:r,totalUsers:s[0].count}}catch(e){return console.error("Error fetching users:",e),{users:[],totalUsers:0}}}async function R(e){try{return await x.select().from(N).where((0,f.eq)(N.id_user,e))}catch(t){return console.error(`Error fetching transactions for user ${e}:`,t),[]}}async function L(e){try{let t=await x.select().from(v).where((0,f.eq)(v.idUser,e)).limit(1);return t.length>0?t[0]:null}catch(t){return console.error(`Error fetching user ${e}:`,t),null}}(0,w.fC)(b)},93159:(e,t,r)=>{"use strict";r.d(t,{G:()=>i,c:()=>n});var s=r(67096),a=r.n(s);async function n(e){return await a().hash(e,10)}async function i(e,t){return await a().compare(e,t)}},73278:(e,t,r)=>{"use strict";e.exports=r(30517)},54203:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ReflectAdapter",{enumerable:!0,get:function(){return r}});class r{static get(e,t,r){let s=Reflect.get(e,t,r);return"function"==typeof s?s.bind(e):s}static set(e,t,r,s){return Reflect.set(e,t,r,s)}static has(e,t){return Reflect.has(e,t)}static deleteProperty(e,t){return Reflect.deleteProperty(e,t)}}},24444:(e,t)=>{"use strict";function r(e,t){let r;let s=e.split("/");return(t||[]).some(t=>!!s[1]&&s[1].toLowerCase()===t.toLowerCase()&&(r=t,s.splice(1,1),e=s.join("/")||"/",!0)),{pathname:e,detectedLocale:r}}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"normalizeLocalePath",{enumerable:!0,get:function(){return r}})},98050:(e,t)=>{"use strict";function r(e){return e.replace(/\/$/,"")||"/"}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"removeTrailingSlash",{enumerable:!0,get:function(){return r}})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[379,61,309,45],()=>r(39355));module.exports=s})();